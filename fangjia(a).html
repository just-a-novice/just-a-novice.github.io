<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>房价分析</title>
    <script src="js/echarts.js"></script>
    <!--    <script src="js/china.js"></script>-->
    <script src="js/jquery-3.5.1.js"></script>

</head>

<body>
    <div class="container" style="height: 100% ;width: 70%; background-color: white">

        <div id="content-left" style="margin-top: 20px">
            <form id="radioForm">
                <input type="radio" name="dataOption" value="four" checked>
                <p style="font-size: 14px; display: inline;"> 排名前四城市</p>
                <input type="radio" name="dataOption" value="all">
                <p style="font-size: 14px; display: inline;"> 展示其他城市</p>
            </form>
            <div id="mainfj" style="width: 700px;height:590px">
            </div>
        </div>

    </div>
</body>
<script>
    get();

    function get() {
        let
            myChart =
            echarts.init(document.getElementById('mainfj'));
        let
            data;
        let
            citys = []
        let
            series = []
        let
            four = ['北京',
                '上海',
                '厦门',
                '深圳'
            ]
        //页面设置
        option
            = {
                title: {
                    text: '城市近两年每周平均房价',
                    x: 'center'
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        label: {
                            backgroundColor: '#6a7985'
                        }
                    }
                },
                dataZoom: [{
                    type: 'slider',
                    start: 30,
                    end: 100,
                    left: '15%',
                    right: 40,
                    bottom: '6%',
                }],
                legend: {
                    //顶部展示城市选项
                    top: '10%',
                    left: 'left',
                    type: 'scroll',
                    orient: 'vertical',
                    //垂直布局，默认水平布局
                    data: ['北京',
                        '上海',
                        '广州',
                        '深圳'
                    ],
                    selected: {
                        '深圳': true,
                    }
                },
                toolbox: {
                    feature: {
                        saveAsImage: {},
                    }
                },
                grid: {
                    left: '10%',
                    right: '4%',
                    top: '20%',
                    bottom: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: ['2009/6/12',
                        '2009/6/13',
                        '2009/6/14',
                        '2009/6/15',
                        '2009/6/15'
                    ]
                },
                yAxis: {
                    min: 10000,
                    type: 'value',
                    name: '价格(元/㎡)'
                },
                series: [{
                        name: '北京',
                        type: 'line',
                        stack: '总量',
                        areaStyle: {},
                        data: []
                    },
                    {
                        name: '上海',
                        type: 'line',
                        stack: '总量',
                        areaStyle: {},
                        data: [200,
                            250,
                            300
                        ]
                    },
                    {
                        name: '广州',
                        type: 'line',
                        stack: '总量',
                        areaStyle: {},
                        data: [150,
                            232,
                            201,
                            154,
                            190
                        ]
                    },
                    {
                        name: '深圳',
                        type: 'line',
                        stack: '总量',
                        areaStyle: {},
                        data: [320,
                            332,
                            301,
                            334
                        ]
                    }
                ]
            };
        myChart.setOption(option);
        myChart.on('legendselectchanged',
            function (params) {
                let
                    res =
                    findMinAndMax(params)
                console.log("最小值：",
                    res['min'])
                console.log("最大值：",
                    res['max'])
                myChart.setOption({
                    yAxis: {
                        min: res['min'],
                        max: res['max']
                    }
                });
            });
        //找最大、最小值
        function
        findMinAndMax(params) {
            let
                maxValue =
                Number.NEGATIVE_INFINITY;
            let
                minValue =
                Number.POSITIVE_INFINITY;
            myChart.getOption().series.forEach(function (series) {
                if (params.selected[series.name]) {
                    series.data.forEach(function (value) {
                        if (value >
                            maxValue)
                            maxValue =
                            value;
                        if (value <
                            minValue) minValue = value;
                    });
                }
            });
            return {
                min: minValue,
                max: maxValue
            };
        }
        fetch('json/房价_total.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // 读取数据
                this.data = data;
                let selected = {}
                let time = []
                let first = true;
                for (let city in data) {
                    citys.push(city)
                    let term = {
                        name: city,
                        type: 'line',
                        stack: city,
                        data: []
                    }
                    if (!four.includes(city)) {
                        selected[city] = false;
                    } else
                        term['areaStyle'] = {};
                    let l = []
                    for (let i = 0; i < data[city].length; i++) {
                        if (first === true) {
                            let date = new Date(data[city][i][0]); // 获取当前日期 //
                            let formattedDate = date.getFullYear() + '-' + ('0' + (date.getMonth() + 1)).slice(-2) +
                                '-' + ('0' +
                                    date.getDate()).slice(-2);
                            time.push(formattedDate);
                        }
                        l.push(data[city][i][1]);
                    }
                    first = false;
                    term.data = l;
                    series.push(term)
                }
                myChart.setOption({
                    xAxis: {
                        data: time
                    },
                    series: series,
                    legend: {
                        selected: selected,
                        data: four
                    },
                    yAxis: {
                        min: 33750,
                        max: 74821
                    }
                });
            }).catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            });
        // 监听单选框变化事件
        let radioForm = document.getElementById('radioForm');
        radioForm.addEventListener('change', function (event) {
            let selectedValue = event.target.value;
            let newData;
            if (selectedValue === 'four') {
                newData = four;
            } else if (selectedValue === 'all') {
                newData = citys;
            }
            // 更新散点图数据
            myChart.setOption({
                legend: {
                    data: newData
                }
            });
        });
    }
</script>

</html>